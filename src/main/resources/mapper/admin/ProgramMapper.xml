<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.hospital.admin.mapper.ProgramMapper">
	<select id="programs" resultType="kr.co.hospital.admin.dto.ProgramDto">
			SELECT p.*, 
			       GROUP_CONCAT(DISTINCT 
			           CASE pd.day_of_week
			               WHEN 1 THEN '월'
			               WHEN 2 THEN '화'
			               WHEN 3 THEN '수'
			               WHEN 4 THEN '목'
			               WHEN 5 THEN '금'
			               WHEN 6 THEN '토'
			               WHEN 0 THEN '일'
			           END
			       ORDER BY pd.day_of_week SEPARATOR ', ') AS days_of_week
			FROM program p
			INNER JOIN programdays pd ON p.pro_id = pd.pro_id
			GROUP BY p.pro_id
			ORDER BY p.pro_id DESC
	</select>
	<insert id="insertprogram">
		insert into program(pro_name, pro_img, pro_info,teach_name,
		pro_time,pro_inwon,pro_part,start_date,end_date,writeday)
		values(#{pro_name},#{pro_img},#{pro_info},#{teach_name},#{pro_time},#{pro_inwon},#{pro_part},#{start_date},#{end_date},now())
	</insert>
	<insert id="insertProgramDay">
        INSERT INTO programdays (pro_id, day_of_week) 
        VALUES (#{pro_id}, #{day_of_week})
    </insert>

    <delete id="deleteProgramDays">
        DELETE FROM programdays WHERE pro_id = #{pro_id}
    </delete>
    
    <select id="selectrecentid" resultType="Integer">
    	select max(pro_id) from program
    </select>
    
    <delete id="deleteProgram">
		delete from program where pro_id=#{pro_id}    	
    </delete>
    <select id="getContent" resultType="kr.co.hospital.admin.dto.ProgramDto">
    	select * from program
    	where pro_id = #{pro_id}
    </select>	
</mapper>